# Process Manager Configuration - Process Types Example
# This example demonstrates the three different process types:
# 1. StandardManaged - Full lifecycle control (spawn, monitor, terminate)
# 2. Unmanaged - Attach to existing process (monitoring only)
# 3. IntegratedManaged - Like StandardManaged with gRPC health checks (Phase 2.2)

process_manager:
  port: 50055
  log_level: "info"
  force_shutdown_timeout: "30s"

managed_processes:
  # ========================================
  # StandardManaged Process
  # ========================================
  # Process manager has full control:
  # - Spawns the process
  # - Creates and manages PID file
  # - Can terminate the process
  # - Applies restart policies
  # - Enforces resource limits
  - id: "web-server"
    type: "standard_managed"
    enabled: true
    management:
      control:
        executable: "/usr/local/bin/my-web-server"
        arguments: ["--port", "8080", "--config", "web.yaml"]
        working_directory: "/var/www"
        environment:
          ENV: "production"
          LOG_LEVEL: "info"
        startup_timeout: "10s"
        shutdown_timeout: "15s"
      
      # Optional: Health checks
      health_check:
        enabled: true
        interval: "30s"
        timeout: "5s"
        failure_threshold: 3
        http_endpoint: "http://localhost:8080/health"
      
      # Optional: Resource limits
      resource_limits:
        max_memory_mb: 1024
        max_cpu_percent: 80.0
      
      # Optional: Restart policy
      restart_policy:
        strategy: "on_failure"
        max_attempts: 3
        restart_delay: "5s"
        backoff_multiplier: 2.0
  
  # ========================================
  # Unmanaged Process
  # ========================================
  # Process manager only monitors:
  # - Attaches to existing process via PID file
  # - Reads PID file (doesn't create it)
  # - Cannot terminate the process
  # - No restart policies
  # - No resource limits
  # - External process continues running after manager stops
  - id: "system-daemon"
    type: "unmanaged"
    enabled: true
    management:
      control:
        executable: "systemd"  # Not used for spawning, just metadata
        arguments: []
        startup_timeout: "5s"
        shutdown_timeout: "5s"
      
      # Optional: Health checks for monitoring
      health_check:
        enabled: true
        interval: "60s"
        timeout: "10s"
        failure_threshold: 5
        http_endpoint: "http://localhost:9090/health"
  
  # Note: For unmanaged processes, you must create the PID file externally:
  # - Unix: /run/hsu-process-manager/system-daemon.pid
  # - Windows: %ProgramData%\HSU\hsu-process-manager\system-daemon.pid
  # The PID file should contain just the process ID as a number.
  
  # ========================================
  # IntegratedManaged Process (Phase 2.2)
  # ========================================
  # Like StandardManaged, but with built-in gRPC health checks:
  # - Spawns the process
  # - Creates and manages PID file
  # - Can terminate the process
  # - Applies restart policies
  # - Automatic gRPC health checking (no separate config needed)
  - id: "grpc-service"
    type: "integrated_managed"
    enabled: true
    management:
      control:
        executable: "/usr/local/bin/my-grpc-service"
        arguments: ["--port", "50051"]
        startup_timeout: "10s"
        shutdown_timeout: "15s"
      
      # For IntegratedManaged, health checks are automatic via gRPC
      # The service is expected to implement the gRPC Health Checking Protocol
      # Health check configuration is simplified:
      health_check_run_options:
        interval: "30s"
        timeout: "5s"
        failure_threshold: 3
      
      restart_policy:
        strategy: "always"
        max_attempts: 5
        restart_delay: "3s"
        backoff_multiplier: 1.5

# ========================================
# Process Type Comparison
# ========================================
#
# | Feature                | StandardManaged | IntegratedManaged | Unmanaged |
# |------------------------|-----------------|-------------------|-----------|
# | Spawn Process          | ‚úÖ Yes          | ‚úÖ Yes            | ‚ùå No     |
# | Terminate Process      | ‚úÖ Always       | ‚úÖ Always         | ‚ùå No     |
# | Restart Policy         | ‚úÖ Yes          | ‚úÖ Yes            | ‚ùå No     |
# | PID File Management    | ‚úÖ Creates      | ‚úÖ Creates        | üìñ Reads  |
# | Health Checks          | ‚öôÔ∏è Optional HTTP | ‚úÖ gRPC Built-in  | ‚öôÔ∏è Optional|
# | Resource Limits        | ‚úÖ Yes          | ‚úÖ Yes            | ‚ùå No     |
# | Process Control Handle | ‚úÖ Yes          | ‚úÖ Yes            | ‚ùå No     |
#
# Use Cases:
# - StandardManaged: Your own services that you want full control over
# - IntegratedManaged: gRPC services with built-in health checks
# - Unmanaged: System services, third-party daemons you want to monitor

